<!DOCTYPE html>
<html>

<head>
    <title>Asset Verfication</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="jquery-ui/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="semantic/semantic.css">
    <link rel="stylesheet" type="text/css" href="fontawesome/css/fontawesome.min.css">
    <script type="text/javascript" src="jquery/jquery.3.5.1.min.js"></script>
    <script type="text/javascript" src="jquery-ui/jquery-ui.min.js"></script>
    <script type="text/javascript" src="semantic/semantic.min.js"></script>
    <script type="text/javascript" src="fontawesome/js/fontawesome.min.js"></script>
</head>

<body>
    <div class="ui sticky" style="background-color: white; padding: 5px;box-shadow: 0px 4px #e5e5e5">
        <div class="ui form">
            <div class="four fields">
                <div class="field">
                    <label> Asset No</label>
                    <div class="ui input">
                        <input type="text" placeholder="Search..." id="txtAssetCode" maxlength="12">
                    </div>
                </div>

                <div class="two fields" style="margin-top: 2%;">
                    <button class="ui primary button" onclick="GetAssetCode();" style="margin-left: 2%;">Search</button>
                </div>
            </div>
            <div id="divAssetDtls"></div>
        </div>
        <!-- <div class="ui padded stacked left aligned segment">
        <div class="ui error message">
            <p>No Data Available. Please check for another date</p>
        </div> -->
        <div class="ui middle aligned relaxed divided list"></div>
        <div class="ui active inverted page dimmer">
            <div class="ui large text loader">Loading Please Wait.....</div>
        </div>
    </div>
    <input type="hidden" id="hempid" />
    <input type="hidden" id="hano" /> <!-- value="201910239075"  -->
    <input type="hidden" id="hdnAItemCode" />
    <input type="hidden" id="hdnADeptCode" />
    <input type="hidden" id="hdnAStorecd" />
    <input type="hidden" id="hdnVerifyTagUser" />
</body>

</html>

<script type="text/javascript">
    document.addEventListener("deviceready", onDeviceReady, false);

    function onDeviceReady() {
        document.addEventListener("backbutton", onBackKeyDown, false);
    }

    function onBackKeyDown() {
        var state = confirm('Are You Sure you want to Exit.');
        if (state)
            navigator.app.exitApp(); // exit the app
    }

    //var apiURL = '../../NnoteApi/Api/Nnote/';
    var apiURL = 'http://115.241.194.19/NnoteApi/Api/Nnote/';

    var qsParm = new Array();

    function qs() {
        var query = window.location.search.substring(1);
        var parms = query.split('&');
        for (var i = 0; i < parms.length; i++) {
            var pos = parms[i].indexOf('=');
            if (pos > 0) {
                var key = parms[i].substring(0, pos);
                var val = parms[i].substring(pos + 1);
                qsParm[key] = val;
            }
        }
        if (parms.length > 0) {
            $("#hempid").val(atob(qsParm["empid"]));
            $("#hano").val(atob(qsParm["ano"]));
            return true;
        } else {
            window.location.href = 'index.html';
            return false;
        }
    }

    $(document).ready(function () {
        qs();
        $.ajaxSetup({
            cache: false
        });
        $('.ui.dropdown').dropdown();
        $('.dimmer').hide();

        $('.error.message').hide();

        $('.message .close').on('click', function () {
            $(this).closest('.message').transition('fade');
        });
        // GetAssetUser();

        GetAssetCode();
    });

    function AssetCancel() {
        return false;
    }

    function isNumberKey(evt) {
        var keycode = (evt.which) ? evt.which : evt.keyCode;
        if (keycode != 46 && keycode > 31 && (keycode < 48 || keycode > 57))
            return false;
        else
            return true;
    }

    $("#txtAssetCode").keypress(function (e) {
        //debugger;
        var current_val = $(this).val();
        //alert(e.keyCode);
        var keycode = (e.which) ? e.which : e.keyCode;
        if (keycode != 46 && keycode > 31 && (keycode < 48 || keycode > 57))
            return false;
        else
            return true;
    });

    function GetAssetCode() {
        $('.dimmer').show();
        $('#divAssetDtls').empty();
        var AssetCode = $("#hano").val();
        if (AssetCode != "") {
            var objdata = {
                assetno: $("#hano").val(),
                userid: $("#hempid").val(),
            };
            $.ajax({
                type: 'POST',
                url: apiURL + 'assetsummary',
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify(objdata),
                success: function (response) {
                    var content = '';
                    content = response.data[0].Contentdata;
                    $('#divAssetDtls').append(content);
                    $('.dimmer').hide();
                }
            });
        } else {
            $('.dimmer').hide();
            alert("Please enter asset code");
        }
    }

    function SaveAssetDetails(Tagval) {
        //alert(val);
        var objdata = {
            assetno: $("#lblassetno").text(),
            itemcode: $("#hdnAItemCode").val(),
            deptcode: $("#hdnADeptCode").val(),
            storecd: $("#hdnAStorecd").val(),
            userid: $("#hempid").val(),
        };
        if (objdata != "") {
            if (Tagval == '1') {
                $.ajax({
                    type: 'POST',
                    // url: apiURL + 'summaryrpt/',
                    url: 'http://localhost:6491/Api/Nnote/assettaging',
                    dataType: "json",
                    contentType: "application/json",
                    data: JSON.stringify(objdata),
                    success: function (response) {
                        if (response.data.length > 0) {
                            var Result = response.data;
                            if (Result == "1") {
                                alert("Asset no " + $("#lblassetno").text() + " Tagged Successfully");
                            } else if (Result == "2") {
                                alert("Asset no " + $("#lblassetno").text() + " Already Tagged");
                            } else if (Result == '-1') {
                                //alert("Asset saved failed");
                            }


                        }
                        ClearAll();
                        $("#divAssetDtls").hide();
                    }
                });
            }
            if (Tagval == '2') {
                $.ajax({
                    type: 'POST',
                    // url: apiURL + 'summaryrpt/',
                    url: 'http://localhost:6491/Api/Nnote/assetverify',
                    dataType: "json",
                    contentType: "application/json",
                    data: JSON.stringify(objdata),
                    success: function (response) {
                        if (response.data.length > 0) {
                            var Result = response.data;
                            if (Result == "1") {
                                alert("Asset no " + $("#lblassetno").text() + " Verified Successfully");
                            } else if (Result == "2") {
                                alert("Asset no " + $("#lblassetno").text() + " Already Verified");
                            } else if (Result == '-1') {
                                //alert("Asset saved failed");
                            }
                        }
                        ClearAll();
                        $("#divAssetDtls").hide();
                    }

                });
            }
        }
    }
</script>